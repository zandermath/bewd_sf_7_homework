<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<div class="container-fluid push">
<div class="search-bar">
	<div class="col-sm-12 col-md-12">
		<%= search_form_for @q do |f| %>
			<div class="field">
				<%= f.collection_select :activity_id_eq, Activity.all, :id, :name, prompt: "Activty" %>
				<%= f.collection_select :location_end_id_eq, LocationEnd.all, :id, :name, prompt: "Destination" %>
				<%= f.label :has_car_eq, "Car?" %>
				<%= f.select :has_car_eq, options_for_select([['Yes', true], ['No', false]]) %>
				<%= f.label :spots_eq, "Number of Peeps" %>
				<%= f.number_field(:spots_eq, in: 1..10, step: 1) %>
				<%= f.label :date_start_gteq, "Leaving between" %>
				<%= f.date_field :date_start_gteq %>
				<%= f.label :date_start_lteq, "and" %>
				<%= f.date_field :date_start_lteq %>
				<div class="actions"><%= f.submit "Search" %></div>
			</div>
		<% end %>  
	</div>
</div>
<div class="row separating-bar"></div>
<div class="col-md-6">
	<% @trips.each do |trip| %>
		<% if trip.date_start.future? %>
			<div class="row trip-listing-container">
      			<div class="col-md-4">
					<%= image_tag attachment_url(trip, :image, :fill, 100, 100) %>
					<%= trip.user.try(:first_name) %>
				</div>
				<div class"col-md-8">
					<%= trip.description %>
					<ul class="list-inline list-unstyled">
						<li>
							<% if trip.has_car %>
								<span><i class="fa fa-car"></i> car</span>
							<% else %>
								<span><i class="fa fa-street-view"></i> no car</span>
							<% end %>
						</li>
						<li>
							<span><i class="fa fa-usd"></i><%= trip.cost %></span>
						</li>
					</ul>
					<ul class="list-inline list-unstyled">
  						<li><span><i class="glyphicon glyphicon-calendar"></i><%= trip.created_at %></span></li>
            			<li>|</li>
            			<span><i class="glyphicon glyphicon-comment"></i> 2 comments</span>
            			<li>|</li>
            			<li>
	               			<span class="glyphicon glyphicon-star"></span>
	                        <span class="glyphicon glyphicon-star"></span>
	                        <span class="glyphicon glyphicon-star"></span>
	                        <span class="glyphicon glyphicon-star"></span>
	                        <span class="glyphicon glyphicon-star-empty"></span>
            			</li>
            			<li>|</li>
            			<li>
			            	<span><i class="fa fa-facebook-square"></i></span>
			            	<span><i class="fa fa-twitter-square"></i></span>
			            	<span><i class="fa fa-google-plus-square"></i></span>
			            </li>
					</ul>
				</div>
			</div>
			<div class="row separating-bar">
			</div>
		<% end %>
	<% end %>
</div>
<div class="col-md-6">
  <div id="map" style='height: 500px;'>
  </div>
</div>

<script type="text/javascript">
var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'map'}}, function(){
  var markers = handler.addMarkers(<%=raw @hash.to_json %>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
</script>

